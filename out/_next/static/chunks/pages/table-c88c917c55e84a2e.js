(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[857],{3771:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/table",function(){return t(1845)}])},1845:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return W}});var r=t(5666),o=t.n(r),i=t(5893),a=t(387),c=t(7294),s=t(6257),u=t(5934),l=(0,t(5503).ZF)({apiKey:"AIzaSyA5HiYzsq8BkJGCJNZtLHa4YOQ76YJ_1vg",authDomain:"planning-p2p.firebaseapp.com",databaseURL:"https://planning-p2p-default-rtdb.firebaseio.com",projectId:"planning-p2p",storageBucket:"planning-p2p.appspot.com",messagingSenderId:"126796717544",appId:"1:126796717544:web:319755cc30177097f3985d"}),f=(0,s.ad)(l),h=t(6810),d=t(2664),v=t(7187),p=t.n(v);function y(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var m=function e(){var n=this,t=this,r=this,o=this,i=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.events=new(p()),this.on=function(e,t){n.events.on(e,t)},this.once=function(e,n){t.events.on(e,n)},this.off=function(e,n){r.events.off(e,n)},this.emit=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var i;(i=o.events).emit.apply(i,[e].concat(y(t)))},this.emitWithChange=function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var o;(o=i.events).emit.apply(o,[e].concat(y(t))),i.events.emit("changes")}};function b(e,n,t,r,o,i,a){try{var c=e[i](a),s=c.value}catch(u){return void t(u)}c.done?n(s):Promise.resolve(s).then(r,o)}function g(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function x(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(s){o=!0,i=s}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var C=function(){function e(n,t){var r=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.roomId=n,this.peerId=t,this.events=new m,this.peerConnections={},this.closed=!1,this.loadingEntry=!1,this.on=this.events.on,this.off=this.events.off,this.init().catch((function(e){console.error(e),r.error=e,r.events.emitWithChange("errorInit",e)}))}var n,t,r;return n=e,(t=[{key:"init",value:function(){return(e=o().mark((function e(){var n,t,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,this.loadingEntry=!0,this.events.emit("changes"),t=(0,s.JU)(f,"rooms",this.roomId),e.next=6,(0,s.QT)(t);case 6:if((r=e.sent).exists()){e.next=11;break}return e.next=10,(0,s.pl)(t,{createdAt:s.EK.now(),peerConnections:w({},"".concat(this.peerId),{lastActivatedAt:s.EK.now()})});case 10:(0,h.x)("Create Room ".concat(this.roomId));case 11:if(!r.exists()){e.next=14;break}return e.next=14,(0,s.r7)(t,w({},"peerConnections.".concat(this.peerId),{lastActivatedAt:s.EK.now()}));case 14:this.loadingEntry=!1,this.events.emit("changes"),i=(0,s.cf)(t,(function(e){e.exists()||n.close(),n.entry=e.data(),n.events.emitWithChange("updateEntry"),n.scanPeerRelations()})),this.events.once("close",(function(){i()}));case 18:case"end":return e.stop()}}),e,this)})).bind(this),function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){b(i,r,o,a,c,"next",e)}function c(e){b(i,r,o,a,c,"throw",e)}a(void 0)}))})();var e}},{key:"scanPeerRelations",value:function(){if(this.entry){var e=!0,n=!1,t=void 0;try{for(var r,o=Object.entries((0,d.w3)(this.entry.peerConnections))[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)x(r.value,1)[0],this.peerId}catch(i){n=!0,t=i}finally{try{e||null==o.return||o.return()}finally{if(n)throw t}}}}},{key:"close",value:function(){this.closed=!0,this.events.emitWithChange("close")}},{key:"attach",value:function(e){this.events.emitWithChange("peerConnectionAdded",e)}},{key:"detach",value:function(e){this.events.emitWithChange("peerConnectionRemoved",e)}}])&&g(n.prototype,t),r&&g(n,r),e}(),j=(0,c.createContext)(void 0),O=function(e){var n=e.peerId,t=e.roomId,r=(e.peerConnections,e.children),o=(0,c.useState)(),i=o[0],a=o[1];return(0,c.useEffect)((function(){console.log("mount");var e=new C(t,n);globalThis.peerConnectionListUtil=e;var r=function(){var n;console.log("tick"),a((function(t){return{v:(null!==(n=null===t||void 0===t?void 0:t.v)&&void 0!==n?n:0)+1,peerConnectionListUtil:e}}))};return e.on("changes",r),e.on("close",(function(){(0,h.x)("Rooms is closed")})),function(){console.log("unmount"),e.close(),e.off("changes",r)}}),[n,t]),(null===i||void 0===i?void 0:i.peerConnectionListUtil)?(0,c.createElement)(j.Provider,{value:i},r):null},k=t(9539),E=t(9435),I=t.n(E),A=function(e){var n=e.src,t=(0,c.useMemo)((function(){return(0,i.jsx)(I(),{children:(0,k.inspect)(n,{colors:!0,depth:null})})}),[n]);return(0,i.jsx)("pre",{style:{padding:10,backgroundColor:"#f5f5f5",border:"1px solid #ccc",borderRadius:5},children:(0,i.jsx)("code",{children:t})})},P=t(4184),T=t.n(P);function R(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function _(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var S=function(e){var n=e.className,t=_(e,["className"]);return(0,i.jsx)("button",function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){R(e,n,t[n])}))}return e}({className:T()(n,"border px-4 py-2 rounded","hover:bg-gray-100")},t))},N=t(4155);var L=function(e,n){var t=void 0===n?function(){return"".concat((0,u.Z)())}:n,r=(0,a.useRouter)(),o=r.query[e],i="string"===typeof o?o:void 0;return(0,c.useEffect)((function(){if(r.isReady&&!i&&globalThis.location){var n=new URL(globalThis.location.href);n.searchParams.set(e,t()),N.nextTick((function(){globalThis.location.href=n.href}))}}),[r.isReady]),i},U=function(e){e=null!==e?e:function(e){throw e}(new TypeError("Cannot destructure undefined"));var n=(0,d.Wx)((0,c.useContext)(j));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(S,{onClick:function(){var e=new URL(globalThis.location.href);e.searchParams.delete("i"),navigator.clipboard.writeText(e.href),(0,h.x)("Copied to clipboard the room link.")},children:"Copy Room"}),(0,i.jsx)(A,{src:n})]})},W=function(){var e=L("i"),n=L("room-id",(function(){return"".concat(Date.now(),"-").concat((0,u.Z)())}));return n&&e?(0,i.jsx)(O,{peerId:e,roomId:n,children:(0,i.jsx)("div",{className:"md:px-20 md:py-5",children:(0,i.jsx)(U,{})})}):(0,i.jsx)(i.Fragment,{children:"loading..."})}}},function(e){e.O(0,[16,867,774,888,179],(function(){return n=3771,e(e.s=n);var n}));var n=e.O();_N_E=n}]);