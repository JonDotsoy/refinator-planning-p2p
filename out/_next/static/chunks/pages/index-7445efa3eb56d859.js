(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5301:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(5075)}])},5075:function(e,n,t){"use strict";t.r(n),t.d(n,{IndexPage:function(){return j}});var r=t(5666),i=t.n(r),o=t(5893),a=t(387),s=t(7294),c=t(5934),d=t(7187),u=t.n(d),l=t(2664);function f(e,n,t,r,i,o,a){try{var s=e[o](a),c=s.value}catch(d){return void t(d)}s.done?n(c):Promise.resolve(c).then(r,i)}function h(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){f(o,r,i,a,s,"next",e)}function s(e){f(o,r,i,a,s,"throw",e)}a(void 0)}))}}function p(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){v(e,n,t[n])}))}return e}function g(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function b(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var m=new(u()),w=function(){var e=(0,s.useState)([]),n=e[0],t=e[1];return(0,s.useEffect)((function(){var e=function(e){var n=(0,l.GM)(e);t((function(e){return b(e).concat([n])})),setTimeout((function(e){return t((function(n){return n.filter((function(n){return n!==e}))}))}),4e3,n)};return m.on("log",e),function(){m.off("log",e)}}),[]),(0,o.jsx)("div",{style:{position:"absolute",right:0,bottom:0,padding:10},children:n.map((function(e){return(0,o.jsx)("div",{style:{padding:"5px 8px",borderRadius:5,border:"solid 1px black",marginBottom:4,minWidth:600},children:e.text},e.id)}))})},y=function(e){m.emit("log",e)},C=function(){function e(){var n=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var t,r=this;this.events=new(u()),this.messages=[],this.on=this.events.on.bind(this.events),this.emit=this.events.emit.bind(this.events),this.off=this.events.off.bind(this.events),this.addEventListener=this.events.addListener.bind(this.events),this.removeEventListener=this.events.removeListener.bind(this.events),this.pasteMessage=h(i().mark((function e(){var n,t,o,a,s,d,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.clipboard){e.next=25;break}return e.next=3,r.clipboard.readText();case 3:for(n=e.sent,t=JSON.parse(n),o=!0,a=!1,s=void 0,e.prev=6,d=t[Symbol.iterator]();!(o=(u=d.next()).done);o=!0)l=u.value,r.events.emit("message",l),console.log("message",l);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),a=!0,s=e.t0;case 14:e.prev=14,e.prev=15,o||null==d.return||d.return();case 17:if(e.prev=17,!a){e.next=20;break}throw s;case 20:return e.finish(17);case 21:return e.finish(14);case 22:y({id:(0,c.Z)(),text:"Pasted ".concat(t.length," messages")}),e.next=26;break;case 25:y({id:(0,c.Z)(),text:"Clipboard is not supported"});case 26:case"end":return e.stop()}}),e,null,[[6,10,14,22],[15,,17,21]])})).bind(this)).bind(this),this.copyMessages=h(i().mark((function e(){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.clipboard){e.next=8;break}return n=r.messages,r.messages=[],e.next=5,r.clipboard.writeText(JSON.stringify(n));case 5:y({id:(0,c.Z)(),text:"Copied ".concat(n.length," messages, and clean messages.")}),e.next=9;break;case 8:y({id:(0,c.Z)(),text:"Clipboard is not available"});case 9:case"end":return e.stop()}}),e)})).bind(this)).bind(this),(null===(t=globalThis.navigator)||void 0===t?void 0:t.clipboard)&&(this.clipboard=globalThis.navigator.clipboard),this.events.on("send-message",(function(e){n.messages.push(e)}))}var n,t,r;return n=e,(t=[{key:"send",value:function(e){this.emit("send-message",e)}}])&&p(n.prototype,t),r&&p(n,r),e}();var j=function(){var e=(0,a.useRouter)(),n=g(function(e,n,t){var r=(0,s.useMemo)((function(){return new C}),[]),o=(0,s.useState)({calls:[]}),a=o[0],d=o[1];if((0,s.useEffect)((function(){if(globalThis.RTCPeerConnection){var e=new RTCPeerConnection(u);y({id:(0,c.Z)(),text:"Local Created peer connection"});var n=e.createDataChannel("sender"),t=e.createDataChannel("receiver");d((function(r){return x({},r,{peerConnection:e,senderChannel:n,receiverChannel:t})})),r.on("message",h(i().mark((function n(t){var o;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.offer){n.next=11;break}return n.next=3,e.setRemoteDescription(new RTCSessionDescription((0,l.Rk)(t.offer)));case 3:return y({id:(0,c.Z)(),text:"Local Set remote description"}),n.next=6,e.createAnswer();case 6:return o=n.sent,n.next=9,e.setLocalDescription(o);case 9:y({id:(0,c.Z)(),text:"Local Set local description"}),r.send({answer:o});case 11:case"end":return n.stop()}}),n)})))),e.addEventListener("icecandidate",(function(e){e.candidate&&(r.send({"new-ice-candidate":e.candidate}),y({id:(0,c.Z)(),text:"Local Send new ice candidate"}))})),e.addEventListener("connectionstatechange",(function(n){y({id:(0,c.Z)(),text:"Local peer connection state changed to ".concat(e.connectionState)})}))}}),[]),!e||!globalThis.RTCPeerConnection)return[new Error("Not supported")];var u={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},f=h(i().mark((function e(){var n,t,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RTCPeerConnection(u),y({id:(0,c.Z)(),text:"Created peer connection"}),n.addEventListener("connectionstatechange",(function(e){y({id:(0,c.Z)(),text:"Local peer connection state changed to ".concat(n.connectionState)})})),t=n.createDataChannel("sender"),o=n.createDataChannel("receiver"),r.addEventListener("message",h(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("message",t),!t.answer){e.next=4;break}return e.next=4,n.setRemoteDescription((0,l.Rk)(t.answer));case 4:if(!t["new-ice-candidate"]){e.next=7;break}return e.next=7,n.addIceCandidate((0,l.Mg)(t["new-ice-candidate"]));case 7:case"end":return e.stop()}}),e)})))),e.next=8,n.createOffer();case 8:return a=e.sent,y({id:(0,c.Z)(),text:"Created offer"}),e.next=12,n.setLocalDescription(a);case 12:y({id:(0,c.Z)(),text:"Set local description"}),r.send({offer:a}),d((function(e){return x({},e,{calls:b(e.calls).concat([{peerConnection:n,offer:a,senderChannel:t,receiverChannel:o}])})}));case 15:case"end":return e.stop()}}),e)}))),p=h(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),v=h(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return[null,e,a,{signalingClipboard:r,createPeerConnection:f,attachRemoteOffer:p,attachCandidates:v}]}("string"===typeof e.query.connid?e.query.connid:void 0),4),t=n[0],r=n[1],d=n[2],u=n[3];return globalThis.conn=d,(0,s.useEffect)((function(){e.isReady&&"string"!==typeof e.query.connid&&e.push("?connid=refinator-planning-".concat((0,c.Z)()))}),[e]),(0,s.useEffect)((function(){}),[u]),(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{children:["UUID ",">"," ",r]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{children:"Form"}),(0,o.jsx)("button",{onClick:null===u||void 0===u?void 0:u.createPeerConnection,children:"Create Peer Connection"}),(0,o.jsx)("button",{onClick:null===u||void 0===u?void 0:u.signalingClipboard.pasteMessage,children:"Paste message"}),(0,o.jsx)("button",{onClick:null===u||void 0===u?void 0:u.signalingClipboard.copyMessages,children:"Copy messages"})]}),(0,o.jsxs)("div",{children:[t&&(0,o.jsx)("pre",{children:(0,o.jsx)("code",{children:JSON.stringify(t,null,2)})}),(null===d||void 0===d?void 0:d.candidates)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Candidates"}),d.candidates.map((function(e,n){return(0,o.jsx)("pre",{children:(0,o.jsx)("code",{children:JSON.stringify(e,null,2)})},n)}))]}),d&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"State"}),(0,o.jsx)("pre",{children:(0,o.jsx)("code",{children:JSON.stringify(d,null,2)})})]}),(null===d||void 0===d?void 0:d.offer)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Offer"}),(0,o.jsx)("pre",{children:(0,o.jsx)("code",{children:d.offer.sdp})})]}),r&&(null===d||void 0===d?void 0:d.remoteOffer)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("h3",{children:"Remote Offer"}),(0,o.jsx)("pre",{children:(0,o.jsx)("code",{children:d.remoteOffer.sdp})})]})]}),(0,o.jsx)(w,{})]})};n.default=function(){return null}}},function(e){e.O(0,[774,888,179],(function(){return n=5301,e(e.s=n);var n}));var n=e.O();_N_E=n}]);